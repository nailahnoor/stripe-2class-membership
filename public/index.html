<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2 Group Classes Membership</title>
<script src="https://js.stripe.com/v3/"></script>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Montserrat',sans-serif; background:#f7f7f7; padding:40px; }
.container { max-width:480px; margin:auto; background:white; padding:24px; border-radius:10px; }
.step { display:none; }
button { width:100%; padding:12px; margin-top:16px; font-size:16px; cursor:pointer; background:#ff9900; border:none; color:white; text-transform:uppercase; }
input, select { font-size:14px; color:#000; border-radius:4px; border:1px solid #ccc; padding:8px; margin-top:4px; }
#payment-error { color:red; margin-top:8px; font-weight:bold; }
</style>
</head>
<body>
<div class="container">

  <div id="step1" class="step" style="display:block;">
    <h2>Membership Terms</h2>
    <ul>
      <li>First month charged in full (no proration)</li>
      <li>Classes do not roll over</li>
      <li>All purchases are final</li>
      <li>Membership auto-renews unless canceled before next billing date</li>
    </ul>
    <input type="checkbox" id="agreeTerms"> I agree to the terms
    <div id="terms-error" style="color:red; display:none;">You must agree</div>
    <button id="toStep2">Continue</button>
  </div>

  <div id="step2" class="step">
    <span id="backToStep1">← Back</span>
    <h2>Contact Info</h2>
    <input type="text" id="name" placeholder="Full Name"><br>
    <select id="countryCode"><option value="+1">US +1</option><option value="+44">UK +44</option><option value="+91">India +91</option></select>
    <input type="tel" id="phone" placeholder="Phone"><br>
    <input type="email" id="email" placeholder="Email"><br>
    <button id="toStep3">Continue to Payment</button>
  </div>

  <div id="step3" class="step">
    <span id="backToStep2">← Back</span>
    <h2>Payment</h2>
    <div id="payment-element"></div>
    <button id="submit">Submit Payment</button>
    <div id="payment-error"></div>
  </div>

</div>

<script>
const BACKEND_URL = "/api/create-payment-intent";
const stripe = Stripe("pk_test_51QG3MjAXY9hpMKCtZnFYTiRFjCHqD8jjci5n8fCNQ4OfxKrAnYBGuk7Iq3jDE1NGTiT8SBCIl70RQ2h2HCavPDbW00oAxvTmIf");

const step1 = document.getElementById("step1");
const step2 = document.getElementById("step2");
const step3 = document.getElementById("step3");

document.getElementById("toStep2").addEventListener("click", () => {
  if(!document.getElementById("agreeTerms").checked){ document.getElementById("terms-error").style.display="block"; return; }
  document.getElementById("terms-error").style.display="none";
  step1.style.display="none"; step2.style.display="block";
});

document.getElementById("toStep3").addEventListener("click", async () => {
  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const phone = document.getElementById("countryCode").value + document.getElementById("phone").value.trim();
  if(!name||!email||!phone){ alert("Fill all fields"); return; }

  step2.style.display="none"; step3.style.display="block";

  const res = await fetch(BACKEND_URL,{ method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({name,email,phone}) });
  const data = await res.json();
  if(!res.ok||!data.client_secret){ document.getElementById("payment-error").textContent=data.error||"Failed to fetch client_secret"; return; }

  const elements = stripe.elements({ clientSecret:data.client_secret });
  const paymentElement = elements.create("payment"); paymentElement.mount("#payment-element");

  document.getElementById("submit").onclick = async ()=>{
    const {error} = await stripe.confirmPayment({elements, confirmParams:{return_url:"/confirmation.html"}});
    if(error) document.getElementById("payment-error").textContent=error.message;
  };
});

document.getElementById("backToStep1").addEventListener("click",()=>{ step2.style.display="none"; step1.style.display="block"; });
document.getElementById("backToStep2").addEventListener("click",()=>{ step3.style.display="none"; step2.style.display="block"; });
</script>
</body>
</html>
